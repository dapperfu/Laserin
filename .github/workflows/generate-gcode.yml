name: Generate G-code from SVG

on:
  push:
    branches:
      - '*'

jobs:
  generate-gcode:
    runs-on: ubuntu-24.04
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
      
      - name: Install Inkscape
        run: |
          sudo apt-get update
          sudo apt-get install -y inkscape
      
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      
      - name: Install laser-tool
        run: |
          pip install git+https://github.com/dapperfu/laser-tool.git
      
      - name: Find SVG files
        id: find-svg
        run: |
          svg_files=$(find . -name "*.svg" -not -path "./.git/*" | tr '\n' ' ')
          echo "files=$svg_files" >> $GITHUB_OUTPUT
          echo "Found SVG files:"
          echo "$svg_files"
      
      - name: Generate G-code files
        run: |
          for svg in $(find . -name "*.svg" -not -path "./.git/*"); do
            echo "Processing $svg"
            laser-gcode "$svg" || echo "Warning: Failed to process $svg"
          done
      
      - name: Upload G-code artifacts
        uses: actions/upload-artifact@v4
        with:
          name: gcode-files
          path: "*.gcode"
          retention-days: 30
          if-no-files-found: warn
